---
title: "웹 동작 방식"
category: "javascript"
cover: images/thumbnail/js.png
coverAlt: "how web work"
datePublished: "2017-03-01"
dateModified: "2017-03-01"
description: "웹 동작 방식 설명"
tags:
  - tag
---

## 구성 요소

1. 인터넷 연결: 웹에서 데이터를 주고받을 수 있게 해준다.
2. TCP/IP: 데이터가 어떻게 웹을 건너 전달되어야 하는지 정의한 통신규약
3. DNS: 웹사이트를 위한 주소록과 같으며 웹 주소를 브라우저에서 입력할 때 웹사이트를 검색하기 전에 DNS를 살펴본다.
4. 컴포넌트 파일: 많은 파일로 만들어지며 2가지 주요 타입이 있다.

컴포넌트 파일의 2가지 타입

- 코드 파일: HTML, CSS, JS
- 자원: 이미지, 음악, 동영상, PDF와 같은 것들이 있다.

## 요청 / 응답 과정

1. 브라우저 주소창에 도메인을 입력한 후 DNS 서버에 해당 도메인의 IP를 요청.
2. DNS에서 일치하는 IP 전달.
3. DNS에서 전달받은 IP로 HTTP로 데이터 요청. (Request)
4. Server는 Client 요청에 알맞은 데이터를 패킷이라 불리는 작은 일련의 덩어리로 전송. ( 전송되는 모든 Data는 TCP/IP 연결을 통해 전송된다. )
5. 브라우저는 패킷을 완전한 웹사이트 파일로 다시 조립하고 화면에 나타낸다.

## 브라우저 동작 원리

### 구성 요소

- UI: 주소창, 즐겨찾기 버튼 등 UI 적 요소.
- 렌더링 엔진: HTML과 CSS를 파싱하고 콘텐츠를 화면에 표시한다.
- 브라우저 엔진: UI와 렌더링 엔진 사이의 동작을 제어한다.
- 네트워킹: HTTP, Request와 같은 네트워크 호출을 다룬다.
- 자바스크립트 해석기: JS 코드를 파싱하고 실행한다.
- 데이터 스토리지: 쿠키 같은 로컬 영역에 데이터를 저장시킬 공간.

**렌더링 엔진**  
서버에서 받아온 HTML, CSS 파일을 화면에 표시하는 역할을 한다. HTML 및 XML 문서 그리고 이미지를 표시할 수 있다.

동작과정

1. 불러오기: Loader라는 녀석이 리소스 스트림을 읽는 과정이다. 읽으면서 이미 읽은 데이터인지 파일을 다운받을지 판단한다.
2. 파싱: HTML 문서를 브라우저가 이해하고 사용할 수 있는 구조( DOM Tree )를 만든다.  
   파싱단계에서 문서가 잘못 제작되었더라도 파서가 오류를 수정해준다. 예를 들면 head 태그를 생략해도 이 단계에서 추가된다.  
   CSS 파일도 파싱되며 CSS의 모든 정보를 스타일 구조체로 형성하고 이를 CSSOM이라고 부른다.
3. DOM Tree와 CSSOM을 결합하여 렌더링 트리를 생성한다.  
   렌더링 트리는 화면이 표시될 필요 없는 ( display: none, head, title 태그 등 )부분은 렌더 트리에 추가하지 않으며 박스 모델을 포함하고 있다.
4. 레이아웃: 렌더트리의 객체에 위치와 크기를 정해주는 과정이다.
5. 페인팅: UI 백 엔드가 화면에 그리는 과정이며 렌더트리를 탐색하면서 특정 메모리 공간이 RGB 값을 채운다.
6. 화면에 표시 렌더링 엔진은 위의 단계를 점진적으로 진행한다.  
   사용자 경험을 위해 네트워크에서 데이터를 받는 대로 위의 과정을 진행하여 브라우저에 콘텐츠가 조금 더 빠르게 나타나게 한다.

```js
// DOM Tree 형태
{ document: { html: { head: {}, body: { div: {} } }} }
```

DOM Tree 생성 과정

1. HTML을 불러온 뒤 HTML Parser로 파싱한다.
2. 자바스크립트를 불러오고 파싱한 후, DOM을 생성한다.  
   DOM은 ECMAScript가 문서 객체를 제어할 수 있게 DOM API를 제공한다. DOM API는 프로그래밍언어( 자바스크립트 )로 웹페이지를 제어할 수 있도록 DOM 요소에 접근하여 요소를 변경할 수 있게 도와준다.

## 런타임

![RunTimeImage](/images/howWebWork/runTime.png)
**자바스크립트 엔진 ( V8 )**

- Memory Heap: 메모리 할당이 일어나는 곳.
- Call Stack: 코드 실행에 따라 호출 스택이 쌓이는 곳이다.
  자바스크립트 엔진은 호출 스택이 하나(싱글 쓰레드)이기 때문에 한 번에 한 가지 일만 할 수 있다. 호출 스택은 기본적으로 우리가 프로그램상 어디 있는지를 기록하는 자료구조이며 호출 스택의 각 단계를 스택 프레임이라고 한다.

**Web APIs**

- DOM( document ), AJSX( XMLHttpRequest ), Timeout( setTimeout )

- Event Loop: CallStack과 Callback Queue의 상태를 지속해서 확인한다.
- Callback Queue: 런타임에서 처리해야 할 Task들을 임시 저장하는 곳이다.  
  CallStack이 비워졌을 때 대기열에 들어온 순서대로 실행된다. 예를 들어 settimeout이 CallStack에서 실행되면 설정한 시간만큼 background에 임시 저장되고 이후에 CallBack Queue에 저장된다.
